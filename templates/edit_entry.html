<!DOCTYPE html>
<html data-bs-theme='dark'>
<head>
  <title>Edit Entry</title>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'>
  <script>
    function setNow(fieldId) {
      const now = new Date();
      const local = new Date(now.getTime() - now.getTimezoneOffset() * 60000);
      const formatted = local.toISOString().slice(0, 16);
      document.getElementsByName(fieldId)[0].value = formatted;
    }
  </script>
</head>
<body class='bg-dark text-light'>
  <div class='container mt-5'>
    <h1>Edit Service Entry</h1>
    <form method='post'>
      <div class='mb-3'>
        <label class='form-label'>Host</label>
        <input class='form-control' name='host' value='{{ entry.host }}' required />
      </div>
      <div class='mb-3'>
        <label class='form-label'>Container Name</label>
        <input class='form-control' name='container_name' value='{{ entry.container_name }}' required />
      </div>
      <div class='mb-3'>
        <label class='form-label'>Image Name</label>
        <div class='form-control bg-dark text-light'>
          {% if entry.image_name %}
            {{ entry.image_registry or '' }}{% if entry.image_registry %}/{% endif %}
            {{ entry.image_owner or '' }}{% if entry.image_owner %}/{% endif %}
            {{ entry.image_name }}{% if entry.image_tag %}:{{ entry.image_tag }}{% endif %}
          {% else %}
            <span class='text-muted'>Not set</span>
          {% endif %}
        </div>
      </div>

      <div class='mb-3'>
        <label class='form-label'>Container ID</label>
        <input class='form-control' name='container_id' value='{{ entry.container_id }}' />
      </div>
      <div class='mb-3'>
        <label class='form-label'>Internal URL</label>
        <input class='form-control' name='internalurl' value='{{ entry.internalurl }}' />
      </div>
      <div class='mb-3'>
        <label class='form-label'>External URL</label>
        <input class='form-control' name='externalurl' value='{{ entry.externalurl }}' />
      </div>
      <div class='mb-3'>
        <label class='form-label'>Stack Name (optional)</label>
        <input class='form-control' name='stack_name' value='{{ entry.stack_name }}' />
      </div>
      <div class='mb-3'>
        <label class='form-label'>Docker Status</label>
        <div class='d-flex align-items-center gap-3'>
          <input class='form-control' name='docker_status' value='{{ entry.docker_status }}' />
          {% if entry.last_api_update %}
            <small class='text-muted' title='{{ entry.last_api_update }}'>
              Updated {{ entry.last_api_update | time_since }}
            </small>
          {% else %}
            <small class='text-muted'>Never updated</small>
          {% endif %}
        </div>
      </div>
      <div class='mb-3'>
        <label class='form-label'>Internal Health Check Enabled</label>
        <select class='form-control' name='internal_health_check_enabled'>
          <option value="" {% if entry.internal_health_check_enabled is none %}selected{% endif %}></option>
          <option value="true" {% if entry.internal_health_check_enabled == True %}selected{% endif %}>True</option>
          <option value="false" {% if entry.internal_health_check_enabled == False %}selected{% endif %}>False</option>
        </select>
      </div>
      <div class='mb-3'>
        <label class='form-label'>Internal Health Check Status</label>
        <input class='form-control' name='internal_health_check_status' value='{{ entry.internal_health_check_status }}' />
      </div>
      <div class='mb-3'>
        <label class='form-label'>Internal Health Check Updated</label>
        <div class='input-group'>
          <input class='form-control' type='datetime-local' name='internal_health_check_update' value='{{ entry.internal_health_check_update }}' />
          <button type='button' class='btn btn-outline-light' onclick="setNow('internal_health_check_update')">Now</button>
        </div>
      </div>
      <div class='mb-3'>
        <label class='form-label'>External Health Check Enabled</label>
        <select class='form-control' name='external_health_check_enabled'>
          <option value="" {% if entry.external_health_check_enabled is none %}selected{% endif %}></option>
          <option value="true" {% if entry.external_health_check_enabled == True %}selected{% endif %}>True</option>
          <option value="false" {% if entry.external_health_check_enabled == False %}selected{% endif %}>False</option>
        </select>
      </div>
      <div class='mb-3'>
        <label class='form-label'>External Health Check Status</label>
        <input class='form-control' name='external_health_check_status' value='{{ entry.external_health_check_status }}' />
      </div>
      <div class='mb-3'>
        <label class='form-label'>External Health Check Updated</label>
        <div class='input-group'>
          <input class='form-control' type='datetime-local' name='external_health_check_update' value='{{ entry.external_health_check_update }}' />
          <button type='button' class='btn btn-outline-light' onclick="setNow('external_health_check_update')">Now</button>
        </div>
      </div>

      <div class='mb-3'>
        <label class='form-label'>Group Name</label>
        <input class='form-control' name='group_name' value='{{ entry.group_name }}' />
      </div>

      <div class='mb-3'>
        <label class='form-label'>Started At</label>
        <div class='form-control bg-dark text-light'>
          {{ entry.started_at | time_since }}
        </div>
      </div>
      <button type='submit' class='btn btn-primary'>Update</button>
      <button type='submit' name='delete' value='1' class='btn btn-danger' onclick="return confirm('Are you sure you want to delete this entry?')">Delete</button>
      <a href='/' class='btn btn-secondary'>Cancel</a>
    </form>
  </div>
</body>
</html>
